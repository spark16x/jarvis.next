<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>J.A.R.V.I.S</title>

  <!-- External Libraries -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.7/dist/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsmediatags@3.9.5/dist/jsmediatags.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Oswald&display=swap" rel="stylesheet">

<link rel="stylesheet" href="/stylesheet/style.css" type="text/css" media="all" />
</head>
<body>


  <div id="musicPlayerContainer">
    <button onclick="closeMusicPlayer()">X</button>
    <iframe id="musicPlayerIframe"></iframe>
  </div>

  <div class="auth-buttons">
    <% if (!user) { %>
      <button onclick="login()">Login</button>
      <button onclick="signup()">Sign Up</button>
    <% } else { %>
    <div class="pfp" >
      <img src="<%= user.profile_pic%>" alt="">
    </div>
    <div class="pfp-nav" hidden>
  <a href="profile"><div class="my-profile"><i class="fa-solid fa-user"></i>my profile  </div></a> 
      <a href="logout"><div class="logout"> logout</div></a><div class="logout"> logout</div>
    </div>
    <% } %>
  </div>

  <div class="chat-box" id="chatBox">
      
  </div>

  <div class="chat-input">
    <input type="file" id="fileInput" hidden />
    <button id="fileButton" aria-label="Attach file"><i class="fa-solid fa-paperclip"></i></button>
    <textarea  id="userInput" placeholder="Ask JARVIS..." ></textarea>
    <button id="micButton"><i class="fa-solid fa-microphone"></i></button>
    <button id="sendButton"><i class="fa-solid fa-paper-plane"></i></button>
  </div>

  <div id="toast"></div>
  <audio id="welcomeSound" src="/sounds/welcome.mp3" preload="auto"></audio>

  <% if (!user) { %>
    <div id="homeAnimation">
      <h1>Welcome to J.A.R.V.I.S</h1>
      <p>Smart, responsive and always ready</p>
    </div>
  <% } %>
<script src="/javascript/main.js"></script>
  <script>
  window.addEventListener("DOMContentLoaded", () => {
  const savedTheme = localStorage.getItem("theme");
  if (savedTheme === "light") {
    document.body.classList.add("light");
    themeToggleBtn.innerHTML = `<i class="fa-solid fa-sun"></i>`;
  }
   <% if (user) { %>
        showToast("Welcome back, <%= user.name %>!", "<%= user.profile_pic %>", "success"  );
      <% } else { %>
        const anim = document.getElementById("homeAnimation");
        if (anim) {
          gsap.fromTo(anim, { opacity: 1 }, { opacity: 0, duration: 2.5, delay: 1.5, onComplete: () => anim.remove() });
        }
      <% } %>
      
      <% if (history) { %>
      <% history.forEach((v)=>{ %>
      <% if (v.role=='user'){%>
      addMessage(`<%= JSON.parse(v.parts[0].text).user %>`,true,true)
      <% }else {%>
        addMessage(`<%= JSON.parse(v.parts[0].text).output %>`,false,<%= JSON.parse(v.parts[0].text).file? JSON.parse(v.parts[0].text).file :false   %>,true);
        <% } %>
      <% }) %>
    <% } %>
    })
  

   
  </script>
  
</body>
</html>